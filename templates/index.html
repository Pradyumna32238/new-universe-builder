{% extends "base.html" %}

{% block title %}Universe Builder - Home{% endblock %}

{% block content %}
  <section class="page-header">
    <h2>Explore Universes</h2>
    <p>Create and manage fictional worlds with their unique characters.</p>
    <form action="{{ url_for('index') }}" method="get" class="search-form">
        <input type="search" name="q" placeholder="Search Universes..." class="search-input" value="{{ search_query or '' }}">
        <button type="submit" class="search-button">Search</button>
    </form>
  </section>

  {% if universes.items %}
    <div class="card-grid">
      {% for universe in universes.items %}
        <article class="card">
          <h3>{{ universe.title }}</h3>
          <p>{{ universe.description or "No description provided." }}</p>
          <div class="actions">
            <a class="button" href="{{ url_for('universe_detail', universe_id=universe.id) }}">View Details</a>
            {% if current_user.is_authenticated and universe.owner_id == current_user.id %}
              <form method="POST" action="{{ url_for('delete_universe', universe_id=universe.id) }}" onsubmit="return confirm('Are you sure you want to delete this universe? This will also delete all characters in it.');">
                <button type="submit" class="button danger">Delete</button>
              </form>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if universes.pages > 1 %}
      <nav class="pagination">
        {% if universes.has_prev %}
          <a href="{{ url_for('index', page=universes.prev_num, q=search_query) }}">&laquo; Previous</a>
        {% endif %}
        
        {% for page_num in universes.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
          {% if page_num %}
            {% if page_num != universes.page %}
              <a href="{{ url_for('index', page=page_num, q=search_query) }}">{{ page_num }}</a>
            {% else %}
              <span class="current">{{ page_num }}</span>
            {% endif %}
          {% else %}
            <span>...</span>
          {% endif %}
        {% endfor %}
        
        {% if universes.has_next %}
          <a href="{{ url_for('index', page=universes.next_num, q=search_query) }}">Next &raquo;</a>
        {% endif %}
      </nav>
    {% endif %}
  {% else %}
    <div class="empty-state">
      {% if search_query %}
        <p>No universes found for your search query. Try another search.</p>
      {% elif current_user.is_authenticated %}
        <p>No universes yet. <a href="{{ url_for('add_universe') }}" class="button primary-pulse">Create the first one.</a></p>
      {% else %}
        <p>No universes have been created yet. Please check back later.</p>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}